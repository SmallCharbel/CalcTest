<!DOCTYPE html>
<html lang="en">
<head>
  <!-- MSAL Script for Authentication -->
  <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Microsoft Security Calculator</title>
  <style>
    /* Global Page Styles */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f4f7;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    .sidebar {
      width: 220px;
      background-color: #30475e;
      color: white;
      display: flex;
      flex-direction: column;
      padding: 20px;
      height: 100vh;
      overflow-y: auto;
      position: fixed;
      border-radius: 0 20px 20px 0;
      box-shadow: 2px 0 15px rgba(0, 0, 0, 0.3);
    }
    .logo {
      width: 100px;
      margin: 0 auto 20px auto;
      transition: transform 0.5s ease;
    }
    .logo:hover {
      transform: rotate(360deg);
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      padding: 14px;
      font-size: 18px;
      margin-bottom: 15px;
      border-radius: 10px;
      background-color: transparent;
      transition: background-color 0.4s, transform 0.3s;
    }
    .sidebar a:hover {
      background-color: #3b536f;
      transform: translateX(10px);
    }
    .title-bar {
      position: fixed;
      top: 0;
      left: 220px;
      right: 380px; /* Leave space for the bill summary */
      z-index: 1000;
      padding: 20px 0;
      text-align: center;
      background-color: transparent;
      box-shadow: none;
    }
    .title-bar h1 {
      margin: 0;
      color: #30475e;
      font-size: 32px;
    }
    .content {
      margin-top: 100px; /* Account for fixed title */
      margin-left: 240px;
      margin-right: 400px; /* Prevent overlap with bill summary */
      padding: 20px;
      background-color: white;
      overflow-y: auto;
      height: calc(100vh - 120px);
      box-sizing: border-box;
      border-radius: 20px;
      box-shadow: -2px 0 15px rgba(0, 0, 0, 0.1);
    }
    .content h2 {
      color: #30475e;
      margin-bottom: 20px;
      font-size: 28px;
      border-bottom: 3px solid #f0f4f7;
      padding-bottom: 10px;
      padding-left: 20px;
    }
    .service-options,
    .service-details {
      padding: 20px;
      background-color: #f9f9f9;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }
    input[type="number"] {
      padding: 12px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      width: 95%;
    }
    .add-to-bill {
      padding: 14px 24px;
      background-color: #007bb5;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.4s, transform 0.3s;
    }
    .add-to-bill:hover {
      background-color: #005f8d;
      transform: translateY(-5px);
    }
    .bill-summary {
      width: 380px;
      background-color: #f4f4f4;
      padding: 30px;
      position: fixed;
      right: 0;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      border-radius: 20px 0 0 20px;
      box-shadow: -2px 0 15px rgba(0, 0, 0, 0.3);
    }
    .bill-summary h3 {
      color: #2d3e50;
      margin-bottom: 10px;
      font-size: 24px;
      border-bottom: 2px solid #f4f4f4;
      padding-bottom: 10px;
      text-align: center;
    }
    .bill-summary .bill-item {
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: flex-start;
    }
    .bill-summary .item-header {
      display: flex;
      justify-content: space-between;
      width: 100%;
    }
    .bill-summary .remove-item {
      color: red;
      font-weight: bold;
      cursor: pointer;
      padding-left: 10px;
      transition: color 0.2s ease, transform 0.2s ease;
    }
    .bill-summary .remove-item:hover {
      color: darkred;
      transform: scale(1.2);
    }
    .bill-summary .item-price {
      font-weight: bold;
      color: #007bb5;
      margin-bottom: 5px;
    }
    .bill-summary .item-details {
      color: #555;
      white-space: normal;
      word-break: break-word;
    }
    .bill-summary .total-cost {
      font-size: 28px;
      font-weight: bold;
      color: #007bb5;
      text-align: right;
      padding-top: 20px;
      border-top: 2px solid #f4f4f4;
      margin-top: 20px;
    }
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: pointer;
      font-size: 20px;
      padding-left: 5px;
      color: #30475e;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 220px;
      background-color: #555;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 8px 0;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -110px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .tooltip .tooltiptext::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #555 transparent transparent transparent;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    /* Custom Table Styles for Defender for Cloud Apps */
    .cloudapps-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .cloudapps-table th,
    .cloudapps-table td {
      padding: 12px 15px;
      text-align: left;
      border: 1px solid #444;
    }
    .cloudapps-table th {
      background-color: #1a3b5d; /* navy blue */
      color: #fff;
      font-weight: bold;
    }
    .cloudapps-table tr:nth-child(even) {
      background-color: #2e2e2e; /* dark grey */
    }
    .cloudapps-table tr:nth-child(odd) {
      background-color: #333;
    }
    .cloudapps-table tr:hover {
      background-color: #244a70;
      transition: background-color 0.3s ease;
    }
    /* Modern Dropdown for Cloud Apps SKU */
    #skuSelectCloudApps {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #fff;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg fill="%23666666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 16px;
    }
    @media (max-width: 600px) {
      .cloudapps-table th,
      .cloudapps-table td {
        padding: 8px;
        font-size: 14px;
      }
      #skuSelectCloudApps {
        font-size: 14px;
      }
    }
  </style>
  <script>
    // MSAL Configuration
    const msalConfig = {
      auth: {
        clientId: "63576da9-88bf-46f2-adea-326796514979",
        authority: "https://login.microsoftonline.com/a05d37d6-5a0d-4083-887d-6b340796809a",
        redirectUri: "https://smallcharbel.github.io/CalcTest/index.html",
      },
      cache: {
        cacheLocation: "sessionStorage",
        storeAuthStateInCookie: false
      }
    };
    const msalInstance = new msal.PublicClientApplication(msalConfig);
    // Check authentication on page load
    async function checkAuth() {
      try {
        const response = await msalInstance.handleRedirectPromise();
        const accounts = msalInstance.getAllAccounts();
        if (accounts.length === 0) {
          window.location.href = 'login.html';
          return;
        }
        document.addEventListener('DOMContentLoaded', () => {
          const sidebar = document.querySelector('.sidebar');
          if (sidebar) {
            const userInfo = document.createElement('div');
            userInfo.style.color = 'white';
            userInfo.style.padding = '10px';
            userInfo.style.marginTop = 'auto';
            userInfo.textContent = `Signed in as: ${accounts[0].username}`;
            sidebar.appendChild(userInfo);
            const logoutButton = document.createElement('a');
            logoutButton.textContent = 'Sign Out';
            logoutButton.style.backgroundColor = '#dc3545';
            logoutButton.style.color = 'white';
            logoutButton.style.cursor = 'pointer';
            logoutButton.style.padding = '10px';
            logoutButton.style.marginTop = '10px';
            logoutButton.style.borderRadius = '4px';
            logoutButton.style.textAlign = 'center';
            logoutButton.onclick = () => {
              msalInstance.logoutRedirect({
                postLogoutRedirectUri: 'login.html'
              });
            };
            sidebar.appendChild(logoutButton);
          }
        });
      } catch (error) {
        console.error(error);
        window.location.href = 'login.html';
      }
    }
    checkAuth();

    /***********************
     * Cost Calculation Functions (unchanged)
     ***********************/
    function calculateSentinelCost() {
      const instances = document.getElementById('sentinel-instances').value;
      const extraRules = document.getElementById('sentinel-extra-rules').value;
      const baseHours = 120;
      const extraRuleCost = extraRules * 5;
      const totalHours = instances * (baseHours + extraRuleCost);
      return totalHours * 190; // Assuming $190 per hour
    }
    function calculateEntraCost() {
      const tenants = document.getElementById('entra-tenants').value;
      const usersPerTenant = document.getElementById('entra-users-per-tenant').value;
      let hoursPerTenant;
      if (usersPerTenant <= 300) { hoursPerTenant = 20; }
      else if (usersPerTenant <= 750) { hoursPerTenant = 30; }
      else if (usersPerTenant <= 1000) { hoursPerTenant = 40; }
      else { alert("Please contact sales for tenants with more than 1000 users."); return 0; }
      const advancedHuntingCost = document.getElementById('entra-advanced-hunting-checkbox').checked ? tenants * 20 * 190 : 0;
      const serviceCost = tenants * hoursPerTenant * 190;
      return serviceCost + advancedHuntingCost;
    }
    function calculateCost(quantityId, rate) {
      const quantity = document.getElementById(quantityId).value;
      return quantity * rate;
    }
    function calculateExchangeCost() {
      const tenants = document.getElementById('tenants').value;
      const usersPerTenant = document.getElementById('users-per-tenant').value;
      let hoursPerTenant;
      if (usersPerTenant <= 300) { hoursPerTenant = 80; }
      else if (usersPerTenant <= 750) { hoursPerTenant = 120; }
      else if (usersPerTenant <= 1000) { hoursPerTenant = 160; }
      else { alert("Please contact Account Executive for tenants with more than 1000 users."); return 0; }
      const advancedHuntingCost = document.getElementById('advanced-hunting-checkbox').checked ? tenants * 20 * 190 : 0;
      const serviceCost = tenants * hoursPerTenant * 190;
      return serviceCost + advancedHuntingCost;
    }
    function calculateCloudAppsCost() {
      const tenants = document.getElementById('cloudapps-tenants').value;
      const usersPerTenant = document.getElementById('cloudapps-users-per-tenant').value;
      let hoursPerTenant;
      if (usersPerTenant <= 300) { hoursPerTenant = 80; }
      else if (usersPerTenant <= 750) { hoursPerTenant = 120; }
      else if (usersPerTenant <= 1000) { hoursPerTenant = 160; }
      else { alert("Please contact Account Executive for tenants with more than 1000 users."); return 0; }
      const advancedHuntingCost = document.getElementById('cloudapps-advanced-hunting-checkbox').checked ? tenants * 20 * 190 : 0;
      const serviceCost = tenants * hoursPerTenant * 190;
      return serviceCost + advancedHuntingCost;
    }
    function calculateEndpointCost() {
      const devices = document.getElementById('devices').value;
      const vulnMgmtDevices = document.getElementById('vuln-mgmt-checkbox').checked ? document.getElementById('vuln-mgmt-devices').value : 0;
      const deviceCost = devices * 150;
      const vulnMgmtCost = vulnMgmtDevices * 50;
      return deviceCost + vulnMgmtCost;
    }
    function calculateIdentityCost() {
      const tenants = document.getElementById('identity-tenants').value;
      const usersPerTenant = document.getElementById('identity-users-per-tenant').value;
      let hoursPerTenant;
      if (usersPerTenant <= 300) { hoursPerTenant = 40; }
      else if (usersPerTenant <= 750) { hoursPerTenant = 60; }
      else if (usersPerTenant <= 1000) { hoursPerTenant = 80; }
      else { alert("Please contact sales for tenants with more than 1000 users."); return 0; }
      const advancedHuntingCost = document.getElementById('identity-advanced-hunting-checkbox').checked ? tenants * 20 * 190 : 0;
      const serviceCost = tenants * hoursPerTenant * 190;
      return serviceCost + advancedHuntingCost;
    }
    /***********************
     * Billing Functions (unchanged)
     ***********************/
    let totalCost = 0;
    function addToBill(serviceName, cost, details) {
      const billItems = document.getElementById('bill-items');
      const existingItem = Array.from(billItems.children).find(item => item.querySelector('.item-header span:first-child').textContent === serviceName);
      let detailsText = '';
      if (details.tenants) { detailsText = `Tenants: ${details.tenants}, Users per Tenant: ${details.users}`; }
      if (details.advancedHunting) { detailsText += ", Advanced Hunting Included"; }
      if (details.instances) { detailsText = `Instances: ${details.instances}`; }
      if (details.extraRules) { detailsText += `, Extra Rules: ${details.extraRules}`; }
      if (details.devices) { detailsText = `Devices: ${details.devices}`; }
      if (details.vulnMgmtDevices) { detailsText += `, Vulnerability Management: ${details.vulnMgmtDevices} Devices`; }
      if (existingItem) {
        const itemDetails = existingItem.querySelector('.item-details');
        const itemPrice = existingItem.querySelector('.item-price');
        itemDetails.textContent = detailsText;
        const previousCost = parseFloat(itemPrice.dataset.previousCost || 0);
        itemPrice.textContent = `$${cost.toFixed(2)}`;
        totalCost = totalCost - previousCost + cost;
        itemPrice.dataset.previousCost = cost.toFixed(2);
      } else {
        totalCost += cost;
        const billItem = document.createElement('div');
        billItem.classList.add('bill-item');
        billItem.innerHTML = `
          <div class="item-header">
            <span>${serviceName}</span>
            <span class="item-price" data-previous-cost="${cost.toFixed(2)}">$${cost.toFixed(2)}</span>
            <span class="remove-item" onclick="removeItem(this, ${cost})">X</span>
          </div>
          <div class="item-details">${detailsText}</div>
        `;
        billItems.appendChild(billItem);
      }
      document.getElementById('total-cost').textContent = totalCost.toFixed(2);
    }
    function removeItem(element, cost) {
      const billItem = element.parentElement.parentElement;
      const previousCost = parseFloat(billItem.querySelector('.item-price').dataset.previousCost);
      billItem.remove();
      totalCost -= previousCost;
      document.getElementById('total-cost').textContent = totalCost.toFixed(2);
      if (totalCost < 0) { totalCost = 0; }
    }
    function exportToExcel() {
      const companyName = prompt("Enter the Company Name:");
      if (!companyName) { alert("Company name is required to export the file."); return; }
      const data = [];
      const billItems = document.querySelectorAll('.bill-item');
      data.push([`${companyName}`]);
      data.push(['Service Name', 'Price', 'Details']);
      billItems.forEach(item => {
        const serviceName = item.querySelector('.item-header span:first-child').textContent;
        const price = item.querySelector('.item-price').textContent;
        const details = item.querySelector('.item-details').textContent.trim();
        data.push([serviceName, price, details]);
      });
      data.push([]);
      data.push(['Total Cost', document.getElementById('total-cost').textContent]);
      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Bill Summary");
      XLSX.writeFile(wb, `${companyName}_BillSummary.xlsx`);
    }
    function toggleVulnerabilityManagement() {
      const vulnMgmtCheckbox = document.getElementById('vuln-mgmt-checkbox');
      const vulnMgmtOptions = document.getElementById('vuln-mgmt-options');
      vulnMgmtOptions.style.display = vulnMgmtCheckbox.checked ? 'block' : 'none';
    }
    /***********************
     * Dynamic SKU Table Code for Exchange Online Protection
     ***********************/
    function populateSKU() {
      const skuSelect = document.getElementById("skuSelect");
      skuSelect.innerHTML = "";
      Object.keys(skuMapping).forEach(sku => {
        const option = document.createElement("option");
        option.value = sku;
        option.textContent = sku;
        skuSelect.appendChild(option);
      });
      skuSelect.addEventListener("change", updateTables);
    }
    function updateTables() {
      const skuSelect = document.getElementById("skuSelect");
      const selectedSKU = skuSelect.value;
      const skuData = skuMapping[selectedSKU];
      let row, cell;
      // Update Defender for Endpoint Table
      const endpointTbody = document.querySelector("#endpointTable tbody");
      endpointTbody.innerHTML = "";
      row = document.createElement("tr");
      cell = document.createElement("td");
      cell.textContent = "Plan 1 Features";
      cell.colSpan = 3;
      cell.className = "section-header";
      row.appendChild(cell);
      endpointTbody.appendChild(row);
      endpointP1Features.forEach(feature => {
        row = document.createElement("tr");
        cell = document.createElement("td");
        cell.textContent = feature.name;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = feature.description;
        row.appendChild(cell);
        cell = document.createElement("td");
        const availableP1 = (skuData.endpoint === "P1" || skuData.endpoint === "P2");
        cell.textContent = availableP1 ? "Yes" : "No";
        cell.className = availableP1 ? "yes" : "no";
        row.appendChild(cell);
        endpointTbody.appendChild(row);
      });
      row = document.createElement("tr");
      cell = document.createElement("td");
      cell.textContent = "Plan 2 Features";
      cell.colSpan = 3;
      cell.className = "section-header";
      row.appendChild(cell);
      endpointTbody.appendChild(row);
      endpointP2Features.forEach(feature => {
        row = document.createElement("tr");
        cell = document.createElement("td");
        cell.textContent = feature.name;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = feature.description;
        row.appendChild(cell);
        cell = document.createElement("td");
        const availableP2 = (skuData.endpoint === "P2");
        cell.textContent = availableP2 ? "Yes" : "No";
        cell.className = availableP2 ? "yes" : "no";
        row.appendChild(cell);
        endpointTbody.appendChild(row);
      });
      // Update Defender for Office 365 Table
      const officeTbody = document.querySelector("#officeTable tbody");
      officeTbody.innerHTML = "";
      row = document.createElement("tr");
      cell = document.createElement("td");
      cell.textContent = "Plan 1 Features";
      cell.colSpan = 3;
      cell.className = "section-header";
      row.appendChild(cell);
      officeTbody.appendChild(row);
      officeP1Features.forEach(feature => {
        row = document.createElement("tr");
        cell = document.createElement("td");
        cell.textContent = feature.name;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = feature.description;
        row.appendChild(cell);
        cell = document.createElement("td");
        const availableOfficeP1 = (skuData.office === "P1" || skuData.office === "P2");
        cell.textContent = availableOfficeP1 ? "Yes" : "No";
        cell.className = availableOfficeP1 ? "yes" : "no";
        row.appendChild(cell);
        officeTbody.appendChild(row);
      });
      row = document.createElement("tr");
      cell = document.createElement("td");
      cell.textContent = "Plan 2 Features";
      cell.colSpan = 3;
      cell.className = "section-header";
      row.appendChild(cell);
      officeTbody.appendChild(row);
      officeP2Features.forEach(feature => {
        row = document.createElement("tr");
        cell = document.createElement("td");
        cell.textContent = feature.name;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = feature.description;
        row.appendChild(cell);
        cell = document.createElement("td");
        const availableOfficeP2 = (skuData.office === "P2");
        cell.textContent = availableOfficeP2 ? "Yes" : "No";
        cell.className = availableOfficeP2 ? "yes" : "no";
        row.appendChild(cell);
        officeTbody.appendChild(row);
      });
      // Update Additional Microsoft 365 Security Features Table
      const m365Tbody = document.querySelector("#m365Table tbody");
      m365Tbody.innerHTML = "";
      additionalM365Features.forEach(feature => {
        row = document.createElement("tr");
        cell = document.createElement("td");
        cell.textContent = feature.name;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = feature.description;
        row.appendChild(cell);
        cell = document.createElement("td");
        const availableExtra = skuData.extra;
        cell.textContent = availableExtra ? "Yes" : "No";
        cell.className = availableExtra ? "yes" : "no";
        row.appendChild(cell);
        m365Tbody.appendChild(row);
      });
    }
    function initEOPTable() {
      const container = document.createElement('div');
      container.className = 'dynamic-table-container';
      container.innerHTML = `
        <div class="service-options">
          <label for="tenants"><strong>Number of Tenants</strong>
            <span class="tooltip">?
              <span class="tooltiptext">A tenant represents a separate Exchange Online instance (e.g., a separate subscription or division).</span>
            </span>
          </label>
          <input type="number" id="tenants" value="1" min="1">
          <label for="users-per-tenant"><strong>Number of Users per Tenant</strong>
            <span class="tooltip">?
              <span class="tooltiptext">Used in cost calculations. Typically, up to 300 users allocate 80 hours, 750 users 120 hours, and 1000 users 160 hours.</span>
            </span>
          </label>
          <input type="number" id="users-per-tenant" value="1" min="1">
        </div>
        <div class="service-options">
          <input type="checkbox" id="advanced-hunting-checkbox">
          <label for="advanced-hunting-checkbox"><strong>Include Advanced Hunting</strong></label>
          <span class="tooltip">?
            <span class="tooltiptext">Advanced Hunting enables proactive inspection for potential threats using Microsoft Defender queries.</span>
          </span>
        </div>
        <label for="skuSelect"><strong>Select a License SKU:</strong></label>
        <select id="skuSelect"></select>
        <h2>Microsoft Defender for Endpoint Features</h2>
        <table id="endpointTable">
          <thead>
            <tr>
              <th>Feature Name</th>
              <th>Feature Description</th>
              <th>Availability</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <h2>Microsoft Defender for Office 365 Features</h2>
        <table id="officeTable">
          <thead>
            <tr>
              <th>Feature Name</th>
              <th>Feature Description</th>
              <th>Availability</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <h2>Additional Microsoft 365 Security Features</h2>
        <table id="m365Table">
          <thead>
            <tr>
              <th>Feature Name</th>
              <th>Feature Description</th>
              <th>Availability</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      `;
      const serviceDetails = document.getElementById('service-details');
      serviceDetails.innerHTML = "";
      serviceDetails.appendChild(container);
      populateSKU();
      updateTables();
    }
    /***********************
     * New Dynamic Table for Microsoft Defender for Cloud Apps
     ***********************/
    // Allowed SKUs for Cloud Apps
    const cloudAppsAllowedSKUs = [
      "Microsoft 365 E5",
      "Microsoft 365 A5",
      "Microsoft 365 F5 Security",
      "Enterprise Mobility + Security E5"
    ];
    // Cloud Apps Features Array
    const cloudAppsFeatures = [
      { name: "Shadow IT Discovery", description: "Identifies and monitors unsanctioned apps being used within the organization." },
      { name: "App Governance", description: "Provides insights into app usage patterns, data flows, and potential risks." },
      { name: "Threat Protection", description: "Detects and responds to threats using machine learning and behavioral analytics." },
      { name: "Data Loss Prevention (DLP)", description: "Prevents sensitive data from being shared or leaked outside the organization." },
      { name: "Information Protection", description: "Classifies and labels data to ensure proper handling based on sensitivity." },
      { name: "Compliance and Governance", description: "Ensures cloud app usage complies with industry regulations and standards." },
      { name: "ATP for SaaS Apps", description: "Extends protection to files stored in SaaS apps like SharePoint, OneDrive, and Teams." },
      { name: "Automated Investigation and Response (AIR)", description: "Automates the investigation and remediation of threats." },
      { name: "Threat Intelligence", description: "Provides detailed threat intelligence and analysis." },
      { name: "App-to-App Protection", description: "Protects inter-app data exchange with application governance." }
    ];
    function populateSKUCloudApps() {
      const skuSelect = document.getElementById("skuSelectCloudApps");
      skuSelect.innerHTML = "";
      cloudAppsAllowedSKUs.forEach(sku => {
        const option = document.createElement("option");
        option.value = sku;
        option.textContent = sku;
        skuSelect.appendChild(option);
      });
      skuSelect.addEventListener("change", updateTablesCloudApps);
    }
    function updateTablesCloudApps() {
      const skuSelect = document.getElementById("skuSelectCloudApps");
      const selectedSKU = skuSelect.value;
      // Since only allowed SKUs are in the dropdown, every feature will be included.
      let available = cloudAppsAllowedSKUs.includes(selectedSKU) ? "Yes" : "No";
      let tbody = document.querySelector("#cloudAppsTable tbody");
      tbody.innerHTML = "";
      cloudAppsFeatures.forEach(feature => {
        let row = document.createElement("tr");
        let cell = document.createElement("td");
        cell.textContent = feature.name;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = feature.description;
        row.appendChild(cell);
        cell = document.createElement("td");
        cell.textContent = available;
        cell.className = available === "Yes" ? "yes" : "no";
        row.appendChild(cell);
        tbody.appendChild(row);
      });
    }
    function initCloudAppsTable() {
      let container = document.createElement('div');
      container.className = 'dynamic-table-container';
      container.innerHTML = `
        <div class="service-options">
          <label for="cloudapps-tenants"><strong>Number of Tenants</strong>
            <span class="tooltip">?
              <span class="tooltiptext">A tenant represents a separate instance (e.g., a separate subscription or division).</span>
            </span>
          </label>
          <input type="number" id="cloudapps-tenants" value="1" min="1">
          <label for="cloudapps-users-per-tenant"><strong>Number of Users per Tenant</strong>
            <span class="tooltip">?
              <span class="tooltiptext">Used in cost calculations.</span>
            </span>
          </label>
          <input type="number" id="cloudapps-users-per-tenant" value="1" min="1">
        </div>
        <div class="service-options">
          <input type="checkbox" id="cloudapps-advanced-hunting-checkbox">
          <label for="cloudapps-advanced-hunting-checkbox"><strong>Include Advanced Hunting</strong></label>
          <span class="tooltip">?
            <span class="tooltiptext">Advanced Hunting enables proactive threat detection.</span>
          </span>
        </div>
        <label for="skuSelectCloudApps"><strong>Select a License SKU:</strong></label>
        <select id="skuSelectCloudApps"></select>
        <h2>Cloud Apps Features</h2>
        <table id="cloudAppsTable" class="cloudapps-table">
          <thead>
            <tr>
              <th>Feature Name</th>
              <th>Feature Description</th>
              <th>Availability</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      `;
      const serviceDetails = document.getElementById('service-details');
      serviceDetails.innerHTML = "";
      serviceDetails.appendChild(container);
      populateSKUCloudApps();
      updateTablesCloudApps();
    }
    /***********************
     * Service Selection Logic
     ***********************/
    function showService(service) {
      const serviceDetails = document.getElementById('service-details');
      const serviceTitle = document.getElementById('service-title');
      serviceDetails.innerHTML = ''; // Clear previous content
      if (service === 'exchange') {
        serviceTitle.textContent = 'Exchange Online Protection';
        initEOPTable();
        const addBtn = document.createElement("button");
        addBtn.className = "add-to-bill";
        addBtn.textContent = "Add to Bill";
        addBtn.onclick = function() {
          const tenants = document.getElementById('tenants').value;
          const users = document.getElementById('users-per-tenant').value;
          const advHunting = document.getElementById('advanced-hunting-checkbox').checked;
          addToBill('Exchange Online Protection', calculateExchangeCost(), { tenants: tenants, users: users, advancedHunting: advHunting });
        };
        serviceDetails.appendChild(addBtn);
      } else if (service === 'defender') {
        serviceTitle.textContent = 'Microsoft Defender for Cloud';
        serviceDetails.innerHTML = `
          <div class="service-options">
            <label for="workloads">Number of Azure Workloads 
              <span class="tooltip">?
                <span class="tooltiptext">Examples: VMs, Storage, Databases, Servers, etc.</span>
              </span>
            </label>
            <input type="number" id="workloads" value="1" min="1">
          </div>
          <div class="service-details">
            <h3>Microsoft Defender for Cloud Summary</h3>
            <p>
              Defender for Cloud provides unified security across your cloud environments by combining Cloud Security Posture Management (CSPM) and Cloud Workload Protection (CWP) along with DevOps security, threat intelligence, and compliance management.
            </p>
            <table class="custom-table">
              <thead>
                <tr>
                  <th>Feature</th>
                  <th>Description</th>
                  <th>Included In</th>
                  <th>View Details</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Foundational CSPM</td>
                  <td>Continuous assessments, security recommendations, Secure Score, and benchmark reporting across major clouds.</td>
                  <td>Free Tier</td>
                  <td><a href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/concept-cloud-security-posture-management" target="_blank">View Details</a></td>
                </tr>
                <tr>
                  <td>Advanced CSPM</td>
                  <td>Advanced threat detection and compliance management for deeper security insights.</td>
                  <td>Enhanced Security</td>
                  <td><a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/" target="_blank">View Details</a></td>
                </tr>
                <tr>
                  <td>Defender for Servers</td>
                  <td>Protects VMs and servers with EDR, vulnerability management, and file integrity monitoring.</td>
                  <td>Enhanced Security</td>
                  <td><a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/" target="_blank">View Details</a></td>
                </tr>
                <tr>
                  <td>Defender for App Service</td>
                  <td>Protects web applications running on Azure App Service.</td>
                  <td>Enhanced Security</td>
                  <td><a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/" target="_blank">View Details</a></td>
                </tr>
                <tr>
                  <td>Defender for SQL</td>
                  <td>Provides advanced threat protection for SQL databases.</td>
                  <td>Enhanced Security</td>
                  <td><a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/" target="_blank">View Details</a></td>
                </tr>
                <tr>
                  <td>Defender for Storage</td>
                  <td>Protects Azure Storage accounts from threats.</td>
                  <td>Enhanced Security</td>
                  <td><a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/" target="_blank">View Details</a></td>
                </tr>
                <tr>
                  <td>Defender for Kubernetes</td>
                  <td>Secures Kubernetes clusters with threat detection and compliance monitoring.</td>
                  <td>Enhanced Security</td>
                  <td><a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/" target="_blank">View Details</a></td>
                </tr>
                <tr>
                  <td>Defender for Containers</td>
                  <td>Protects containerized applications and environments.</td>
                  <td>Enhanced Security</td>
                  <td><a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/" target="_blank">View Details</a></td>
                </tr>
                <tr>
                  <td>DevOps Security Management</td>
                  <td>Integrates security into CI/CD pipelines and scans IaC for misconfigurations.</td>
                  <td>Enhanced Security</td>
                  <td><a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/" target="_blank">View Details</a></td>
                </tr>
                <tr>
                  <td>Threat Intelligence</td>
                  <td>Uses machine learning and behavioral analytics to detect threats.</td>
                  <td>Enhanced Security</td>
                  <td><a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/" target="_blank">View Details</a></td>
                </tr>
                <tr>
                  <td>Compliance Management</td>
                  <td>Provides regulatory compliance assessments and enforces security policies.</td>
                  <td>Enhanced Security</td>
                  <td><a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/" target="_blank">View Details</a></td>
                </tr>
              </tbody>
            </table>
            <p>
              <strong>License Options:</strong> Defender for Cloud Free Tier (Foundational CSPM) or Enhanced Security (includes advanced CSPM, CWP, DevOps security, threat intelligence, and compliance management).
            </p>
          </div>
          <button class="add-to-bill" onclick="addToBill('Microsoft Defender for Cloud', calculateCost('workloads', 150), {workloads: document.getElementById('workloads').value})">Add to Bill</button>
        `;
      } else if (service === 'cloudApps') {
        serviceTitle.textContent = 'Microsoft Defender for Cloud Apps';
        // Initialize the Cloud Apps dynamic table section using our new functions
        initCloudAppsTable();
        const addBtn = document.createElement("button");
        addBtn.className = "add-to-bill";
        addBtn.textContent = "Add to Bill";
        addBtn.onclick = function() {
          const tenants = document.getElementById('cloudapps-tenants').value;
          const users = document.getElementById('cloudapps-users-per-tenant').value;
          const advHunting = document.getElementById('cloudapps-advanced-hunting-checkbox').checked;
          addToBill('Microsoft Defender for Cloud Apps', calculateCloudAppsCost(), { tenants: tenants, users: users, advancedHunting: advHunting });
        };
        document.getElementById('service-details').appendChild(addBtn);
      } else if (service === 'endpoint') {
        serviceTitle.textContent = 'Microsoft Defender for Endpoint';
        serviceDetails.innerHTML = `
          <div class="service-options">
            <label for="devices">Number of Devices</label>
            <input type="number" id="devices" value="1" min="1">
          </div>
          <div class="service-options">
            <input type="checkbox" id="vuln-mgmt-checkbox" onclick="toggleVulnerabilityManagement()">
            <label for="vuln-mgmt-checkbox">Include Vulnerability Management</label>
          </div>
          <div class="service-options" id="vuln-mgmt-options" style="display: none;">
            <label for="vuln-mgmt-devices">Number of Devices for Vulnerability Management</label>
            <input type="number" id="vuln-mgmt-devices" value="0" min="0">
          </div>
          <button class="add-to-bill" onclick="addToBill('Microsoft Defender for Endpoint', calculateEndpointCost(), {devices: document.getElementById('devices').value, vulnMgmtDevices: document.getElementById('vuln-mgmt-devices').value})">Add to Bill</button>
          <div class="service-details">
            <h3>Microsoft Defender for Endpoint Summary</h3>
            <ul>
              <li><strong>Threat Indicators and Endpoint Protection:</strong>
                <ul>
                  <li>Custom File and Network Indicators for banning suspicious files and blocking/allowing IPs, URLs, or domains.</li>
                  <li>Endpoint Detection and Response (EDR) to detect and block malicious artifacts.</li>
                </ul>
              </li>
              <li><strong>Response Capabilities and Vulnerability Management:</strong>
                <ul>
                  <li>Device and Live Response capabilities for rapid threat mitigation.</li>
                  <li>Vulnerability Management for visibility, assessments, and remediation.</li>
                </ul>
              </li>
            </ul>
          </div>
        `;
      } else if (service === 'identity') {
        serviceTitle.textContent = 'Microsoft Defender for Identity';
        serviceDetails.innerHTML = `
          <div class="service-options">
            <label for="identity-tenants">Number of Tenants</label>
            <input type="number" id="identity-tenants" value="1" min="1">
            <label for="identity-users-per-tenant">Number of Users per Tenant</label>
            <input type="number" id="identity-users-per-tenant" value="1" min="1">
          </div>
          <div class="service-options">
            <input type="checkbox" id="identity-advanced-hunting-checkbox">
            <label for="identity-advanced-hunting-checkbox">Include Advanced Hunting</label>
            <span class="tooltip">?
              <span class="tooltiptext">Advanced Hunting enables proactive threat inspection.</span>
            </span>
          </div>
          <button class="add-to-bill" onclick="addToBill('Microsoft Defender for Identity', calculateIdentityCost(), {tenants: document.getElementById('identity-tenants').value, users: document.getElementById('identity-users-per-tenant').value, advancedHunting: document.getElementById('identity-advanced-hunting-checkbox').checked})">Add to Bill</button>
          <div class="service-details">
            <h3>Microsoft Defender for Identity Summary</h3>
            <ul>
              <li><strong>Modern Identity Threat Detection (ITDR):</strong>
                <ul>
                  <li>Uses signals from on-premises AD and cloud identities to detect advanced threats.</li>
                  <li>Provides comprehensive protection against identity-based attacks.</li>
                </ul>
              </li>
              <li><strong>Entity Tags:</strong>
                <ul>
                  <li>Tags sensitive accounts for enhanced event detection.</li>
                  <li>Honeytoken accounts trigger alerts on unauthorized access.</li>
                </ul>
              </li>
            </ul>
          </div>
        `;
      } else if (service === 'entra') {
        serviceTitle.textContent = 'Microsoft Entra ID Protection';
        serviceDetails.innerHTML = `
          <div class="service-options">
            <label for="entra-tenants">Number of Tenants</label>
            <input type="number" id="entra-tenants" value="1" min="1">
            <label for="entra-users-per-tenant">Number of Users per Tenant</label>
            <input type="number" id="entra-users-per-tenant" value="1" min="1">
          </div>
          <div class="service-options">
            <input type="checkbox" id="entra-advanced-hunting-checkbox">
            <label for="entra-advanced-hunting-checkbox">Include Advanced Hunting</label>
            <span class="tooltip">?
              <span class="tooltiptext">Advanced Hunting enables proactive inspection for potential threats.</span>
            </span>
          </div>
          <button class="add-to-bill" onclick="addToBill('Microsoft Entra ID Protection', calculateEntraCost(), {tenants: document.getElementById('entra-tenants').value, users: document.getElementById('entra-users-per-tenant').value, advancedHunting: document.getElementById('entra-advanced-hunting-checkbox').checked})">Add to Bill</button>
          <div class="service-details">
            <h3>Microsoft Entra ID Protection Summary</h3>
            <ul>
              <li><strong>Risk-Based Access Policies:</strong>
                <ul>
                  <li>Enhances security with Conditional Access that responds to sign-in risks.</li>
                  <li>Evaluates authentication attempts and applies controls based on risk levels.</li>
                </ul>
              </li>
              <li><strong>Advanced Risk Detection and Response:</strong>
                <ul>
                  <li>Continuously monitors identity signals for threats and unauthorized access.</li>
                  <li>Automatically adjusts access policies in response to detected risks.</li>
                </ul>
              </li>
            </ul>
          </div>
        `;
      } else if (service === 'sentinel') {
        serviceTitle.textContent = 'Microsoft Sentinel';
        serviceDetails.innerHTML = `
          <div class="service-options">
            <label for="sentinel-instances">Number of Instances</label>
            <input type="number" id="sentinel-instances" value="1" min="1">
          </div>
          <div class="service-options">
            <button onclick="toggleExtraRules()">Include Rules</button>
          </div>
          <div id="extra-rules-section" class="service-options" style="display: none;">
            <label for="sentinel-extra-rules">Extra Rules (14 rules included by default)</label>
            <input type="number" id="sentinel-extra-rules" value="0" min="0">
          </div>
          <button class="add-to-bill" onclick="addToBill('Microsoft Sentinel', calculateSentinelCost(), {instances: document.getElementById('sentinel-instances').value, extraRules: document.getElementById('sentinel-extra-rules').value})">Add to Bill</button>
          <div class="service-details">
            <h3>Microsoft Sentinel Summary</h3>
            <ul>
              <li><strong>User and Entity Behavioral Analytics (UEBA):</strong> Analyzes behaviors to identify suspicious activities.</li>
              <li><strong>Fusion:</strong> Uses machine learning to detect complex multistage attacks.</li>
              <li><strong>Threat Intelligence:</strong> Integrates third-party data to enhance detection and response.</li>
              <li><strong>Automation:</strong> Enables centralized response actions with automation rules.</li>
              <li><strong>Anomaly Rules:</strong> Uses machine learning to detect unusual behaviors.</li>
              <li><strong>Scheduled Queries:</strong> Pre-built queries continuously monitor logs for threats.</li>
              <li><strong>Near-Real-Time (NRT) Rules:</strong> Provide minute-by-minute threat insights.</li>
              <li><strong>Hunting:</strong> Supports proactive threat hunting with custom queries.</li>
              <li><strong>Microsoft Defender XDR Connector:</strong> Synchronizes logs and incidents with Defender XDR.</li>
              <li><strong>Data Connectors:</strong> Ingests data from multiple sources for analysis.</li>
              <li><strong>Content Hub and Solutions:</strong> Enhances Sentinel’s capabilities with tailored content.</li>
              <li><strong>SOAR:</strong> Automates response actions using playbooks.</li>
              <li><strong>Included Rules:</strong>
                <ul>
                  <li>2 Automation Rules</li>
                  <li>5 Scheduled Analytic Rules</li>
                  <li>5 Near Real-Time Analytic Rules</li>
                  <li>2 Automation Rules including Playbooks</li>
                </ul>
              </li>
            </ul>
          </div>
        `;
      }
    }
  </script>
</head>
<body>
  <div class="sidebar">
    <img src="logo.png" alt="Company Logo" class="logo" onclick="window.location.href='https://www.ampiosolutions.com/'">
    <h2>Services</h2>
    <a onclick="showService('exchange')">Exchange Online Protection</a>
    <a onclick="showService('defender')">Microsoft Defender for Cloud</a>
    <a onclick="showService('cloudApps')">Microsoft Defender for Cloud Apps</a>
    <a onclick="showService('endpoint')">Microsoft Defender for Endpoint</a>
    <a onclick="showService('identity')">Microsoft Defender for Identity</a>
    <a onclick="showService('entra')">Microsoft Entra ID Protection</a>
    <a onclick="showService('sentinel')">Microsoft Sentinel</a>
  </div>
  <div class="title-bar">
    <h1>Microsoft Security Calculator</h1>
  </div>
  <div class="content">
    <h2 id="service-title">Select a Service</h2>
    <div id="service-details" class="service-options"></div>
  </div>
  <div id="bill-summary" class="bill-summary">
    <h3>Bill Summary</h3>
    <div id="bill-items"></div>
    <div class="total-cost">Total: $<span id="total-cost">0</span></div>
    <button class="add-to-bill" onclick="exportToExcel()">Export to Excel</button>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>
