<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Microsoft Security Calculator</title>
    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
    <style>
        /* Previous styles remain the same */
    </style>
</head>
<body>
    <div class="login-container">
        <img src="logo.png" alt="Company Logo" class="logo">
        <h1>Microsoft Security Calculator</h1>
        <button id="signIn" class="login-button">Sign in with Microsoft</button>
        <div id="status"></div>
    </div>

    <script>
        const msalConfig = {
            auth: {
                clientId: "63576da9-88bf-46f2-adea-326796514979",
                authority: "https://login.microsoftonline.com/a05d37d6-5a0d-4083-887d-6b340796809a",
                redirectUri: window.location.href.replace('login.html', 'index.html')
            },
            system: {
                loggerOptions: {
                    logLevel: msal.LogLevel.Verbose,
                    loggerCallback: (level, message, containsPii) => {
                        if (!containsPii) {
                            console.log(`[MSAL] ${message}`);
                            document.getElementById('status').innerText = message;
                        }
                    }
                }
            }
        };

        console.log('RedirectUri:', msalConfig.auth.redirectUri);

        const msalInstance = new msal.PublicClientApplication(msalConfig);

        document.getElementById('signIn').onclick = async () => {
            try {
                console.log('Login button clicked');
                const loginRequest = {
                    scopes: ["User.Read"],
                    prompt: "select_account"
                };
                console.log('Login request:', loginRequest);
                await msalInstance.loginRedirect(loginRequest);
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('status').innerText = `Login error: ${error.message}`;
            }
        };

        // Check for redirect response
        msalInstance.handleRedirectPromise()
            .then((response) => {
                console.log('Redirect response:', response);
                if (response) {
                    console.log('Login successful, account:', response.account);
                    sessionStorage.setItem('msalAccount', JSON.stringify(response.account));
                    window.location.href = msalConfig.auth.redirectUri;
                } else {
                    console.log('No redirect response');
                }
            })
            .catch((error) => {
                console.error('Redirect error:', error);
                document.getElementById('status').innerText = `Redirect error: ${error.message}`;
            });

        // Check if user is already logged in
        const accounts = msalInstance.getAllAccounts();
        console.log('Current accounts:', accounts);
        if (accounts.length > 0) {
            console.log('User already logged in, redirecting...');
            window.location.href = msalConfig.auth.redirectUri;
        }
    </script>
</body>
</html>
